# 密码体系二 - 对称密码

> 对称密码是用相同密钥进行加解密的技术体系，使用对称密码可以`确保消息的机密性`，但无法防抵赖。 虽然对称密码可以确保消息机密，但需要解决双方如何`安全传输密钥`的问题。 目前使用最多的对称密码算法是 `AES`。

一般来说，当前的加密体系需要解决以下几个问题:

1. 机密性(第三者无法通过密文猜测出明文)
2. 完整性(第三者无法篡改原文内容)
3. 不可否认性(第三者不能冒充其他人发送消息)

**有时，不可否认性也称之为可认证性，这俩词本质一样**

对称密码目前只能满足第一项(机密性)。只要 Bob 和 Alick(加解密双方)拥有足够强度的密钥，同时确保密钥没有泄露给 Eve(恶意第三人)。那么 Eve 是无法通过密文猜测出原文的。

几乎所有讲密码的资料再提到对称密码时，都会提到`凯撒密码`。 这可能不是最早的对称密码，但绝对是最出名的密码算法。

`凯撒密码`原理是双方都拥有同一本字典，然后双方约定每个字母都移动 N 个位置。加密时，将原文每个字母移动 N 个位置得到密文。 解密时，将密文每个字母向相反位置移动 N 个位置还原回明文。

比如 Bob 和 Alice 采用`凯撒密码`传递信息，双方约定每个字母都右移 3 个位置。 那么会得到下面的图:

![](https://tva1.sinaimg.cn/large/e6c9d24ely1h4n0rfncr2j217406emxx.jpg)

根据这个算法，如果我们要传递`YOSHIKO`这几个字母，那么转换后的密文就是`BRVKLNR`。

在古时如果不依靠计算机，只靠猜，很难猜出原文是啥内容。 但这并不代表`凯撒密码`是安全的。 其中一种破解方法就是计算字频，也就是根据日常中经常出现词汇去和密文中出现频率最高的字母进行对应。 说白了，就是大胆假设，小心求证。

只要 Eve 截获的密文足够多，那么根据词频基本上可以破解的八九不离十。 当前这是建立在 Bob 和 Alice 一直使用同一种`偏移量`的基础之上。 如果 Bob 和 Alice 每通讯一次就变更一次`偏移量`。 那么理论上 Eve 是无法破解密文的。

而这种每通讯一次就变更一次的方式，在密码体系中称之为`一次性密码本`。`一次性密码本`是理论上安全程度最高的加密算法，但实现成本非常高，因此不具有实际价值。 现在除了量子密码距离`一次性密码本`非常近之外，其他加密算法只是在千方百计的向其靠近。

从古代回到现代，借助计算机的强大算力。`凯撒密码`已经变得非常容易破解了，即便不使用词频来分析密文。 靠暴力破解，也可以在很短时间内借出原文。 所以现代密码体系已经不在依靠古老的猜词游戏保证安全性了，转而依靠`数学`问题来保证安全性。

而这些`数学`的基础就是异或(⊕)。 异或的特点是，相同为 0，不同为 1. 比如：

```
0 ⊕ 0 = 0
0 ⊕ 1 = 1
1 ⊕ 0 = 1
1 ⊕ 1 = 0
```

这个特性非常适合进行加解密操作。例如，我们约定`10101010`是密钥，`01001100`是原文。 那么将原文和密钥进行异或操作后会变成:

```
  0 1 0 0 1 1 0 0 原文
⊕ 1 0 1 0 1 0 1 0 密钥
----------------
  1 1 1 0 0 1 1 0 密文
```

将密文对密钥再进行异或操作就很神奇的变回了原文:

```
  1 1 1 0 0 1 1 0 密文
⊕ 1 0 1 0 1 0 1 0 密钥
----------------
  0 1 0 0 1 1 0 0 原文
```

所以只要密钥选择的好，分分钟我们就能实现一个高强度的简单加密算法。(要选择一个好的密钥，需要具备不可预测性，不可重复性。而完成这两个指标最好的方式是随机数。后面再聊伪随机生成器的事情)

异或操作可以说是对称密码的基础了。 主流的对称密码算法中，都是再努力的找到一个高强度的密钥。 我们来看一下主流算法是如何实现的。

- DES
  `DES`使用的是 64 比特长度的密钥，因此它一次只能加密 64 比特的明文。 所以每次加密之前，需要对明文进行分组。 而这种使用固定长度密钥加密多组明文的算法也称作`分组密码`

  ![](https://tva1.sinaimg.cn/large/e6c9d24ely1h4n1le0e1jj20sg0u4acz.jpg)

  可以看到明文每个分组的右侧 32 比特并没有参与加密，仍然处于明文状态。 所以 DES 会再每次计算完毕之后，将左右密文对调，再进行一次计算。 如此反复计算 16 次后，一个明文 64 比特分组才算是真正完成加密。

  中间的密钥是本次分组使用的密钥，是一个局部密钥。也可以称之为"子密钥"。 这个子密钥是根据初始密钥循环左移得到的(当然也可以右移，但 DES 算法规定的是左移)。

- 3DES

  `3DES`是改良过的 DES。这是伴随着计算机算力的增加，DES 已经不安全了，所以衍生出了 3DES。3DES 是使用三组不同的密钥，循环三遍 DES。也成为`三重DES`。

  ![](https://tva1.sinaimg.cn/large/e6c9d24ely1h4n1vwhzowj20m40x2acu.jpg)

- AES

  `AES`是一个标准规范，并不是确定的某个算法。目前`AES`规范所使用的算法是 Rijndael 。同 DES 一样，Rijndael 也有轮的概念和分组的概念。只不过 Rijndael 输入分组是 128 比特。 首先 Rijndael 对明文的 128 比特进行字符替换，也就是说，将一个字节的数据替换成另外一个字节的数据(有点类似于凯撒密码)。然后对替换以后的数据进行平移操作，但平移的偏移量并不相同。而后将平移后的数据组合成比特矩阵。

  最后对这个比特矩阵与分组密钥进行异或操作。(这个过程有点抽象，我也没想象出图应该是什么样的。所以欠一个示意图)。

因为`AES`是一个全球范围内征集算法的规范，所以其每个候选算法都经过了很多专家学者(主要是数学家)的论证。 从安全性和加解密速度上来说，`AES`要比`DES`和`3DES`要好很多。 如果要选择一个靠谱的对称加密算法，那么首推就是`AES`。
